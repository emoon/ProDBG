#include "RegisterView.h"
#include "Backend/IBackendRequests.h"
#include "Ui_RegisterView.h"
#include <QDebug>

namespace prodbg {

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

RegisterView::RegisterView(QWidget* parent)
    : QWidget(parent)
    , m_ui(new Ui_RegisterView)
{
    m_ui->setupUi(this);
    connect(m_ui->pushButton, &QPushButton::released, this, &RegisterView::getSomeData);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

RegisterView::~RegisterView()
{
    delete m_ui;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void RegisterView::dataTypeChanged(int type)
{
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void RegisterView::getSomeData()
{
    if (!m_interface) {
        return;
    }

    qDebug() << "About to request some data";

    // Request 16 bytes

    m_interface->beginReadMemory(0, 16, &m_memRes);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void RegisterView::endReadMemory(QVector<uint16_t>* res, uint64_t address, int addressSize)
{
    qDebug() << "RegisterView Got memory " << res << " " << res->size() << " addressSize " << addressSize;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void RegisterView::setBackendInterface(IBackendRequests* interface)
{
    m_interface = interface;
    connect(m_interface, &IBackendRequests::endReadMemory, this, &RegisterView::endReadMemory);
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
}
