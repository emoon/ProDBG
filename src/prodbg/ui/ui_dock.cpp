#include "ui_dock.h"
#include "core/alloc.h"
#include "api/plugin_instance.h"
#include <vector> // TODO: replace with custom arrays

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

struct ViewPluginInstance;

struct UIDockView
{
	ViewPluginInstance* viewInstance;
	Rect rect; 
};

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

enum UIDockSizerDir
{
	UIDockSizerDir_Horz,
	UIDockSizerDir_Vert,
};

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

struct UIDockSizer
{
	UIDockView* side0;	// up/left
	UIDockView* side1;	// down/right
	UIDockSizerDir dir;
	Rect rect; 
};

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

struct UIDock
{
	struct UIDockSizer* topSizer;
	struct UIDockSizer* bottomSizer;
	struct UIDockSizer* rightSizer;
	struct UIDockSizer* leftSizer;
	struct UIDockView currentView;
};

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

enum UIDockStatus
{
	UIDockStatus_ok,
	UIDockStatus_fail,
};

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

struct UIDockingGrid
{
	std::vector<UIDock*> docks;
	std::vector<UIDockSizer*> sizers;
	Rect rect;
};


///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

const int g_sizerSize = 4; // TODO: Move to settings
//const float g_splitPercentage = 0.5;	// TODO: Move to settings. Default split in middle (50/50)

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

UIDockingGrid* UIDock_createGrid(Rect* rect)
{
	UIDockingGrid* grid = new UIDockingGrid; 
	grid->rect = *rect;

	return grid;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
// This will check if we haven't attached any view to the dock we just set it

static bool checkFirstAttach(UIDock* dock, ViewPluginInstance* instance)
{
	if (dock->currentView.viewInstance)
		return false;

	dock->currentView.viewInstance = instance;
	dock->currentView.rect = instance->rect;

	return true;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

UIDock* UIDock_addView(UIDockingGrid* grid, ViewPluginInstance* view)
{
	(void)grid;
	(void)view;



	return 0;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void UIDock_dockLeft(UIDock* dock, ViewPluginInstance* instance)
{
	if (checkFirstAttach(dock, instance))
		return;

	Rect rect = dock->currentView.rect;

	// TODO: Support non-even split 
	//

	// Push current window forward 

	dock->currentView.rect.y += rect.width;
	dock->currentView.rect.width = rect.width;

	rect.width = int_min(rect.width - g_sizerSize, 0);


	                                
}
/*

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

UIDockStatus UIDock_dockRight(UIDock* dock, ViewPluginInstance* instance)
{

	return UIDockStatus_ok;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

UIDockStatus UIDock_dockBottom(UIDock* dock, ViewPluginInstance* instance)
{

	return UIDockStatus_ok;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

UIDockStatus UIDock_dockTop(UIDock* dock, ViewPluginInstance* instance)
{

	return UIDockStatus_ok;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void UIDock_splitHorzUp(UIDock* dock, ViewPluginInstance* instance)
{



}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

UIDockStatus UIDock_splitHorzDow(UIDock* dock, ViewPluginInstance* instance)
{

	return UIDockStatus_ok;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

UIDockStatus UIDock_splitVertRight(UIDock* dock, ViewPluginInstance* instance)
{

	return UIDockStatus_ok;
}

///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

UIDockStatus UIDock_splitVertLeft(UIDock* dock, ViewPluginInstance* instance)
{

	return UIDockStatus_ok;
}

*/

